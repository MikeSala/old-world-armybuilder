type TranslationMode = "name" | "text";

const PHRASE_REPLACEMENTS: Array<[RegExp, string]> = [
  [/\bOpen War\b/gi, "Otwarta Wojna"],
  [/\bGrand Melee\b/gi, "Wielka Bitwa"],
  [/\bCombined Arms\b/gi, "Połączone Siły"],
  [/\bBattle March\b/gi, "Marsz Bojowy"],
  [/\bBeastmen Brayherds\b/gi, "Stada Zwierzoludzi"],
  [/\bChaos Dwarfs\b/gi, "Krasnoludy Chaosu"],
  [/\bDaemons of Chaos\b/gi, "Demony Chaosu"],
  [/\bDark Elves\b/gi, "Mroczne Elfy"],
  [/\bDwarfen Mountain Holds\b/gi, "Górskie Twierdze Krasnoludów"],
  [/\bEmpire of Man\b/gi, "Imperium Człowieka"],
  [/\bGrand Cathay\b/gi, "Wielkie Cathay"],
  [/\bHigh Elf Realms\b/gi, "Królestwa Wysokich Elfów"],
  [/\bKingdom of Bretonnia\b/gi, "Królestwo Bretonii"],
  [/\bLizardmen\b/gi, "Jaszczury"],
  [/\bOgre Kingdoms\b/gi, "Królestwa Ogrów"],
  [/\bOrc & Goblin Tribes\b/gi, "Plemiona Orków i Goblinów"],
  [/\bRenegade Crowns\b/gi, "Renegackie Korony"],
  [/\bSkaven\b/gi, "Skaveni"],
  [/\bTomb Kings of Khemri\b/gi, "Królowie Grobowców z Khemri"],
  [/\bVampire Counts\b/gi, "Hrabowie Wampirów"],
  [/\bWood Elf Realms\b/gi, "Królestwa Leśnych Elfów"],
  [/\bGrand Army\b/gi, "Wielka Armia"],
  [/\bMinotaur Blood Herd\b/gi, "Krwawe Stado Minotaurów"],
  [/\bWild Herd\b/gi, "Dzika Gromada"],
  [/\bRenegades\b/gi, "Renegaci"],
  [/\bRoyal Clan\b/gi, "Królewski Klan"],
  [/\bExpeditionary Force\b/gi, "Siły Ekspedycyjne"],
  [/\bSlayer Host\b/gi, "Hufiec Zabójców"],
  [/\bCore Army\b/gi, "Armia podstawowa"],
  [/\bCity-State of Nuln\b/gi, "Miasto-Państwo Nuln"],
  [/\bOrder of the Knights Panther\b/gi, "Zakon Rycerzy Pantery"],
  [/\bOrder of the White Wolf\b/gi, "Zakon Białego Wilka"],
  [/\bOrder of the Blazing Sun\b/gi, "Zakon Płonącego Słońca"],
  [/\bOrder of the Knights of Morr\b/gi, "Zakon Rycerzy Morra"],
  [/\bOrder of the Fiery Heart\b/gi, "Zakon Ognistego Serca"],
  [/\bChracian Warhost\b/gi, "Zastęp Chracii"],
  [/\bSea Guard Garrison\b/gi, "Garnizon Straży Morskiej"],
  [/\bErrantry Crusades\b/gi, "Krucjaty Erranckie"],
  [/\bBretonnian Exiles\b/gi, "Bretońscy Wygnańcy"],
  [/Nomadic Waaagh!/gi, "Nomadyczny Waaagh!"],
  [/\bTroll Horde\b/gi, "Horda Trolli"],
  [/\bNehekharan Royal Hosts\b/gi, "Królewskie Zastępy Nehekharu"],
  [/\bMortuary Cults\b/gi, "Kulty Grobowe"],
  [/\bWolves of the Sea\b/gi, "Wilki Mórz"],
  [/\bHeralds of Darkness\b/gi, "Heroldowie Mroku"],
  [/\bOrion's Wild Hunt\b/gi, "Dziki Gon Oriona"],
  [/\bHost of Talsyn\b/gi, "Zastęp Talsynu"],
  [/\bChaos Lord\b/gi, "Władca Chaosu"],
  [/\bChaos Lords\b/gi, "Władcy Chaosu"],
  [/\bChosen Chaos Warriors\b/gi, "Wybrani Wojownicy Chaosu"],
  [/\bChaos Warrior\b/gi, "Wojownik Chaosu"],
  [/\bChaos Warriors\b/gi, "Wojownicy Chaosu"],
  [/\bWarriors of Chaos\b/gi, "Wojownicy Chaosu"],
  [/\bChaos Dragon\b/gi, "Smok Chaosu"],
  [/\bChaos Dragons\b/gi, "Smoki Chaosu"],
  [/\bChaos Armour\b/gi, "Zbroja Chaosu"],
  [/\bDaemon Prince\b/gi, "Książę Demonów"],
  [/\bGaze of the Gods\b/gi, "Spojrzenie Bogów"],
  [/\bTwo-headed Dragon\b/gi, "Dwugłowy Smok"],
  [/\bAdditional hand weapons\b/gi, "Dodatkowa broń ręczna"],
  [/\bHand weapons\b/gi, "Broń ręczna"],
  [/\bGreat weapons\b/gi, "Broń wielka"],
  [/\bAdditional hand weapon\b/gi, "Dodatkowa broń ręczna"],
  [/\bHand weapon\b/gi, "Broń ręczna"],
  [/\bGreat weapon\b/gi, "Broń wielka"],
  [/\bFull plate armour\b/gi, "Pełna zbroja płytowa"],
  [/\bPlate armour\b/gi, "Zbroja płytowa"],
  [/\bHeavy armour\b/gi, "Ciężka zbroja"],
  [/\bLight armour\b/gi, "Lekka zbroja"],
  [/\bCavalry spear\b/gi, "Włócznia kawaleryjska"],
  [/\bThrowing axes\b/gi, "Topory do rzucania"],
  [/\bThrowing axe\b/gi, "Topór do rzucania"],
  [/\bJavelins\b/gi, "Oszczepy"],
  [/\bJavelin\b/gi, "Oszczep"],
  [/\bStandard bearer\b/gi, "Sztandarowy"],
  [/\bStandard Bearer\b/gi, "Sztandarowy"],
  [/\bClose Order\b/gi, "Zwarty Szyk"],
  [/\bOpen Order\b/gi, "Luźny Szyk"],
  [/\bSkirmishers\b/gi, "Harcownicy"],
  [/\bFast Cavalry\b/gi, "Szybka Kawaleria"],
  [/\bHeavy Cavalry\b/gi, "Ciężka Kawaleria"],
  [/\bLight Cavalry\b/gi, "Lekka Kawaleria"],
  [/\bHeavy Infantry\b/gi, "Ciężka piechota"],
  [/\bRegular Infantry\b/gi, "Regularna piechota"],
  [/\bMonstrous Infantry\b/gi, "Monstrualna piechota"],
  [/\bMonstrous Cavalry\b/gi, "Monstrualna kawaleria"],
  [/\bMonstrous Creature\b/gi, "Monstrualne stworzenie"],
  [/\bHeavy Chariot\b/gi, "Ciężki rydwan"],
  [/\bLight Chariot\b/gi, "Lekki rydwan"],
  [/\bWar Beast\b/gi, "Bestia wojenna"],
  [/\bWar Beasts\b/gi, "Bestie wojenne"],
  [/\bWar Machines\b/gi, "Machiny Wojenne"],
  [/\bWar Machine\b/gi, "Machina Wojenna"],
  [/\bWarmachines\b/gi, "Machiny Wojenne"],
  [/\bWarmachine\b/gi, "Machina Wojenna"],
  [/\bInfantry\b/gi, "Piechota"],
  [/\bCavalry\b/gi, "Kawaleria"],
  [/\bChariots\b/gi, "Rydwany"],
  [/\bChariot\b/gi, "Rydwan"],
  [/\bBehemoth\b/gi, "Behemot"],
  [/\bSwarm\b/gi, "Rój"],
  [/\bMagic Resistance\b/gi, "Odporność na Magię"],
  [/\bImmune to Psychology\b/gi, "Odporność na Psychologię"],
  [/\bLarge Target\b/gi, "Duży Cel"],
  [/\bImpact Hits\b/gi, "Uderzenia Impetu"],
  [/\bStomp Attacks\b/gi, "Zdeptanie"],
  [/\bStomp Attack\b/gi, "Zdeptanie"],
  [/\bSwiftstride\b/gi, "Szybki Krok"],
  [/\bFirst Charge\b/gi, "Pierwsza Szarża"],
  [/\bCounter Charge\b/gi, "Przeciwnatarcie"],
  [/\bFurious Charge\b/gi, "Wściekła Szarża"],
  [/\bRallying Cry\b/gi, "Bojowy okrzyk"],
  [/\bRegimental Unit\b/gi, "Jednostka regimentowa"],
  [/\bMagic Attacks\b/gi, "Magiczne Ataki"],
  [/\bPoisoned Attacks\b/gi, "Trujące Ataki"],
  [/\bMove Through Cover\b/gi, "Przechodzenie przez zasłony"],
  [/\bFear\b/gi, "Strach"],
  [/\bTerror\b/gi, "Terror"],
  [/\bStubborn\b/gi, "Nieugięty"],
  [/\bRegeneration\b/gi, "Regeneracja"],
  [/\bMark of Chaos Undivided\b/gi, "Znak Chaosu Niepodzielonego"],
  [/\bMark of Chaos\b/gi, "Znak Chaosu"],
  [/\bNehekharan Undead\b/gi, "Nehekharijscy Nieumarli"],
  [/\bNecromantic Undead\b/gi, "Nekromantyczni Nieumarli"],
  [/\bElven Reflexes\b/gi, "Elfie Refleksy"],
  [/\bHorde\b/gi, "Horda"],
  [/\bUnbreakable\b/gi, "Niezłomni"],
  [/\bLoner\b/gi, "Samotnik"],
  [/\bIndomitable\b/gi, "Nieustępliwy"],
  [/\bEnsorcelled Weapons\b/gi, "Zaklęta Broń"],
  [/\bArmoured Hide\b/gi, "Opancerzona Skóra"],
  [/\bMagical Attacks\b/gi, "Magiczne Ataki"],
  [/\bFlammable\b/gi, "Łatwopalny"],
  [/\bHatred\b/gi, "Nienawiść"],
  [/\bPrimal Fury\b/gi, "Pierwotna Furia"],
  [/\bFly\b/gi, "Lot"],
  [/\bCold Blooded\b/gi, "Zimnokrwisty"],
  [/\bFire & Flee\b/gi, "Ogień i odwrót"],
  [/\bScurry Away\b/gi, "Umknij"],
  [/\bMotley Crew\b/gi, "Zbieranina"],
  [/\bImpetuous\b/gi, "Impet"],
  [/\bAmbushers\b/gi, "Zasadzka"],
  [/\bArmour Bane\b/gi, "Przebicie Zbroi"],
  [/\bUnit Size\b/gi, "Wielkość jednostki"],
  [/\bBase Size\b/gi, "Rozmiar podstawki"],
  [/\bArmour Value\b/gi, "Wartość pancerza"],
  [/\bNamed Character\b/gi, "Nazwana postać"],
  [/\bLegendary Lord\b/gi, "Legendarny Lord"],
  [/\bBarded Warhorse\b/gi, "Opancerzony rumak"],
  [/\bWarhorse\b/gi, "Rumak bojowy"],
  [/\bWarband\b/gi, "Gromada"],
  [/\bVanguard\b/gi, "Awangarda"],
  [/\bScout\b/gi, "Zwiadowca"],
  [/\bScouts\b/gi, "Zwiadowcy"],
  [/\bDetachment\b/gi, "Oddział"],
  [/\bMounts\b/gi, "Wierzchowce"],
  [/\bMount\b/gi, "Wierzchowiec"],
  [/\bWeapons\b/gi, "Broń"],
  [/\bWeapon\b/gi, "Broń"],
  [/\bArmour\b/gi, "Zbroja"],
  [/\bCommand\b/gi, "Dowództwo"],
  [/\bOptions\b/gi, "Opcje"],
];

const WORD_MAP_BASE: Record<string, string> = {
  warrior: "wojownik",
  warriors: "wojownicy",
  knight: "rycerz",
  knights: "rycerze",
  guard: "straż",
  guards: "strażnicy",
  archer: "łucznik",
  archers: "łucznicy",
  spearman: "włócznik",
  spearmen: "włócznicy",
  swordsman: "miecznik",
  swordsmen: "miecznicy",
  crossbowman: "kusznik",
  crossbowmen: "kusznicy",
  rider: "jeździec",
  riders: "jeźdźcy",
  chariot: "rydwan",
  chariots: "rydwany",
  horse: "koń",
  horses: "konie",
  wolf: "wilk",
  wolves: "wilki",
  dragon: "smok",
  dragons: "smoki",
  giant: "olbrzym",
  giants: "olbrzymy",
  ogre: "ogr",
  ogres: "ogry",
  troll: "troll",
  trolls: "trolle",
  goblin: "goblin",
  goblins: "gobliny",
  orc: "ork",
  orcs: "orki",
  elf: "elf",
  elves: "elfy",
  dwarf: "krasnolud",
  dwarfs: "krasnoludy",
  beast: "bestia",
  beasts: "bestie",
  daemon: "demon",
  daemons: "demony",
  demon: "demon",
  demons: "demony",
  spawn: "pomiot",
  mage: "mag",
  wizard: "czarodziej",
  sorcerer: "czarnoksiężnik",
  priest: "kapłan",
  priestess: "kapłanka",
  shaman: "szaman",
  warlock: "czarownik",
  engineer: "inżynier",
  captain: "kapitan",
  general: "generał",
  lord: "władca",
  lords: "władcy",
  hero: "bohater",
  champion: "czempion",
  musician: "muzyk",
  master: "mistrz",
  chieftain: "wódz",
  warlord: "wódz",
  chief: "wódz",
  king: "król",
  queen: "królowa",
  prince: "książę",
  princess: "księżniczka",
  slayer: "zabójca",
  hunter: "łowca",
  ranger: "tropiciel",
  assassin: "skrytobójca",
  infantry: "piechota",
  cavalry: "kawaleria",
  behemoth: "behemot",
  swarm: "rój",
  character: "postać",
  core: "podstawowy",
  special: "specjalny",
  rare: "rzadki",
  monster: "potwór",
  mount: "wierzchowiec",
  crew: "załoga",
  great: "wielki",
  grand: "wielki",
  wild: "dziki",
  savage: "dziki",
  dark: "mroczny",
  high: "wysoki",
  wood: "leśny",
  forest: "leśny",
  sea: "morski",
  blood: "krwawy",
  black: "czarny",
  white: "biały",
  red: "czerwony",
  green: "zielony",
  golden: "złoty",
  silver: "srebrny",
  iron: "żelazny",
  steel: "stalowy",
  stone: "kamienny",
  storm: "burzowy",
  frost: "lodowy",
  fire: "ognisty",
  flame: "płomienny",
  sun: "słoneczny",
  moon: "księżycowy",
};

const WORD_MAP_TEXT: Record<string, string> = {
  ...WORD_MAP_BASE,
  unit: "jednostka",
  units: "jednostki",
  model: "model",
  models: "modele",
  point: "punkt",
  points: "punktów",
  per: "na",
  army: "armia",
  armies: "armie",
  include: "zawiera",
  includes: "zawiera",
  included: "zawiera",
  may: "może",
  can: "może",
  must: "musi",
  if: "jeśli",
  your: "twoja",
  and: "i",
  or: "lub",
  with: "z",
  without: "bez",
  each: "każdy",
  this: "ten",
  these: "te",
  from: "z",
  to: "do",
  in: "w",
  on: "na",
  for: "dla",
  as: "jako",
};

const WORD_REGEX = /\b[A-Za-z][A-Za-z'-]*\b/g;

const toTitleCase = (value: string): string =>
  value
    .split(" ")
    .map((word) => (word ? word[0].toUpperCase() + word.slice(1).toLowerCase() : word))
    .join(" ");

const matchCase = (source: string, replacement: string): string => {
  if (source.toUpperCase() === source) return replacement.toUpperCase();
  if (source.toLowerCase() === source) return replacement.toLowerCase();
  if (source[0] === source[0].toUpperCase()) return toTitleCase(replacement);
  return replacement;
};

const applyPhraseReplacements = (value: string): string =>
  PHRASE_REPLACEMENTS.reduce((acc, [pattern, replacement]) => {
    return acc.replace(pattern, (match) => matchCase(match, replacement));
  }, value);

const applyWordMap = (value: string, wordMap: Record<string, string>): string =>
  value.replace(WORD_REGEX, (match) => {
    const replacement = wordMap[match.toLowerCase()];
    return replacement ? matchCase(match, replacement) : match;
  });

const stripArticlesForNames = (value: string): string =>
  value.replace(/\bof the\b/gi, " ").replace(/\bthe\b/gi, " ").replace(/\bof\b/gi, " ");

export const translateEnToPl = (value: string, mode: TranslationMode = "text"): string => {
  if (!value || typeof value !== "string") return value;
  let result = applyPhraseReplacements(value);
  if (mode === "name") {
    result = stripArticlesForNames(result);
    result = applyWordMap(result, WORD_MAP_BASE);
  } else {
    result = applyWordMap(result, WORD_MAP_TEXT);
  }
  return result.replace(/\s{2,}/g, " ").trim();
};

export const translateEnNameToPl = (value: string): string => translateEnToPl(value, "name");
export const translateEnTextToPl = (value: string): string => translateEnToPl(value, "text");
export type { TranslationMode };
